#!/usr/bin/env bash
set -e

USER=$1
PRETTY=$2
CREATE_DIR=$3

if [ ! -f /mnt/cephfs/home ]; then
    mkdir -p /mnt/cephfs/home
    chmod 711 /mnt/cephfs/home
fi

if [ "${CREATE_DIR}" != "no" ]; then
    # User initialization
    mkdir -p -m771 "/mnt/cephfs/home/${PRETTY}/"
    mkdir -p -m771 "/mnt/cephfs/home/${PRETTY}/Jobs"
    mkdir -p -m771 "/mnt/cephfs/home/${PRETTY}/Trash"

    chown -R ${USER}:${USER} "/mnt/cephfs/home/${PRETTY}"
fi
