# https://sequencediagram.org/

autoactivation
actor "UCloud User\nAlice#1234" as User

participantgroup #lightgreen ** UCloud\nNetwork**
participant "UCloud" as UCloud
database "UCloud DB" as UCloudDB
end

participantgroup #lightblue **Provider\nNetwork**
participantgroup #lightyellow **New components**
participant "Integration Module" as Provider
database "Integration DB" as UserDB
end
participantgroup #pink **Existing components**
participant "Web-portal" as Portal
participant IdP
end

end

User->UCloud: Connect with provider
UCloud->Provider: Alice#1234 wishes to connect
Provider-->UCloud: Redirect user to $URL
UCloud-->User: Redirect user to $URL
User->Portal: GET $URL
Portal-->User: Login form
User->Portal: Credentials
note over Portal: This authentication flow is\nprovider and IdP specific.\nIn many cases the credentials\nare forwarded directly to the\nIdP.
Portal->IdP: Credentials
IdP-->Portal: OK - User is \nalice@idp.example.com
Portal->Provider: Alice#1234 \nhas connected as \nalice@idp.example.com (UID 1100)
Provider->UserDB: Insert mapping between: \nAlice#1234 and alice@idp.example.com (UID 1100)
UserDB-->Provider: OK

Provider->UCloud: Mapping for Alice#1234 complete
UCloud->UCloudDB: Save mapping
UCloudDB-->UCloud: OK
UCloud-->Provider: OK
Provider-->Portal: OK
Portal-->User: OK - Redirect to UCloud interface

== Alice#1234 can now consume resources from the provider ==
